# Phase 2 Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Add Chapters 2-6, SM-2 spaced repetition review system, Tailwind typography plugin, and prepare for Vercel deploy.

**Architecture:** Refactor content loading to be dynamic (current pages hardcode Chapter 1 imports). Add a content registry that maps slugs to theory/philosophy components and quiz data. Add SM-2 spaced repetition lib with a `/review` page. Add `@tailwindcss/typography` for prose styling.

**Tech Stack:** Next.js 16, TypeScript, Tailwind CSS v4, shadcn/ui, Vitest

---

### Task 1: Add @tailwindcss/typography

**Files:**
- Modify: `package.json`
- Modify: `src/app/globals.css`

**Step 1: Install typography plugin**

Run:
```bash
pnpm add @tailwindcss/typography
```

**Step 2: Add to CSS**

In `src/app/globals.css`, add the typography import. For Tailwind v4, add:
```css
@plugin "@tailwindcss/typography";
```

**Step 3: Verify**

Run `pnpm build` — should compile successfully. The `prose` classes used in content pages should now be properly styled.

**Step 4: Commit**

```bash
git add package.json pnpm-lock.yaml src/app/globals.css
git commit -m "chore: add @tailwindcss/typography for prose styling"
```

---

### Task 2: Refactor content loading for multi-chapter support

**Files:**
- Create: `src/lib/content-registry.ts`
- Modify: `src/lib/content.ts`
- Modify: `src/app/chapters/[slug]/theory/page.tsx`
- Modify: `src/app/chapters/[slug]/philosophy/page.tsx`
- Modify: `src/lib/__tests__/content.test.ts`

**Step 1: Create content registry**

Create `src/lib/content-registry.ts` that maps chapter slugs to their React content components and quiz data. Use dynamic imports or a static registry.

Since we're using `"use client"` pages, we can use a simple component map:

```typescript
import type { ComponentType } from "react"
import type { Quiz } from "@/types/content"

interface ChapterContent {
  TheoryContent: ComponentType
  PhilosophyContent: ComponentType
  theoryQuizzes: readonly Quiz[]
  practiceQuizzes: readonly Quiz[]
}

// Static imports for all chapters
import { TheoryContent as Ch01Theory } from "../../content/chapters/01-propositions/theory"
import { PhilosophyContent as Ch01Philosophy } from "../../content/chapters/01-propositions/philosophy"
import ch01TheoryQuizzes from "../../content/chapters/01-propositions/theory-quizzes.json"
import ch01PracticeQuizzes from "../../content/chapters/01-propositions/practice-quizzes.json"

// Will be extended as chapters are added
const CONTENT_REGISTRY: Record<string, ChapterContent> = {
  "01-propositions": {
    TheoryContent: Ch01Theory,
    PhilosophyContent: Ch01Philosophy,
    theoryQuizzes: ch01TheoryQuizzes as unknown as Quiz[],
    practiceQuizzes: ch01PracticeQuizzes as unknown as Quiz[],
  },
}

export function getChapterContent(slug: string): ChapterContent | undefined {
  return CONTENT_REGISTRY[slug]
}
```

**Step 2: Update content.ts**

Refactor `getChapterQuizzes` to use the registry instead of its own map.

**Step 3: Update theory page**

Replace the hardcoded import:
```tsx
// Before:
import { TheoryContent } from "../../../../../content/chapters/01-propositions/theory"

// After:
import { getChapterContent } from "@/lib/content-registry"
// ... in component:
const content = getChapterContent(slug)
if (!content) notFound()
const { TheoryContent } = content
```

**Step 4: Update philosophy page similarly**

**Step 5: Update tests**

Verify `content.test.ts` still passes. Add test for `getChapterContent`.

**Step 6: Verify build**

Run `pnpm build && pnpm test:run`

**Step 7: Commit**

```bash
git add -A
git commit -m "refactor: centralize content registry for multi-chapter support"
```

---

### Task 3: Add Chapter 2 content — 真理値表と恒真式

**Files:**
- Create: `content/chapters/02-truth-tables/theory.tsx`
- Create: `content/chapters/02-truth-tables/philosophy.tsx`
- Create: `content/chapters/02-truth-tables/theory-quizzes.json`
- Create: `content/chapters/02-truth-tables/practice-quizzes.json`
- Modify: `src/lib/content-registry.ts`
- Modify: `src/lib/content.ts` (add to CHAPTERS array)

**Content requirements:**

Theory: 真理値表の構築方法、恒真式(トートロジー)、矛盾式、充足可能式。主要な恒真式（ド・モルガンの法則、二重否定除去、対偶）の解説。

Practice quizzes (3-5問): ビジネス文書の論理構造を真理値表で分析する、プログラミングの条件分岐をド・モルガンの法則でリファクタリングするシナリオなど。

Theory quizzes (5問): 真理値表の穴埋め（P ∨ ¬P、ド・モルガン）、恒真式の判別（選択式）。

Philosophy: ライプニッツの「普遍的記号法」の夢、ブールの「思考の法則」、現代コンピュータへの影響。

**Step 1: Create content files**
**Step 2: Register in content-registry.ts and content.ts**
**Step 3: Verify** `pnpm build && pnpm test:run`
**Step 4: Commit**

```bash
git add content/chapters/02-truth-tables/ src/lib/
git commit -m "feat: add Chapter 2 — Truth Tables and Tautologies"
```

---

### Task 4: Add Chapter 3 content — 論証の妥当性と健全性

**Files:** Same pattern as Task 3 but for `03-validity/`

Theory: 演繹的妥当性と健全性の区別。主要な推論規則（モーダスポネンス、モーダストレンス、仮言三段論法、選言三段論法）。反例による妥当性の否定。

Practice quizzes (3-5問): 契約書や規約の論理構造分析、ビジネス提案の論証構造チェック、コードレビューでの前提確認。

Theory quizzes (5問): 推論規則の適用（選択式）、妥当な論証の判別。

Philosophy: アリストテレスの三段論法の体系化、中世スコラ学の論理学、「妥当だが不健全」な論証の哲学的意義。

**Commit:** `feat: add Chapter 3 — Argument Validity and Soundness`

---

### Task 5: Add Chapter 4 content — 述語論理の基礎

**Files:** Same pattern for `04-predicate-logic/`

Theory: 述語と主語の分析、全称量化子（∀）と存在量化子（∃）、量化子の否定（¬∀x P(x) ≡ ∃x ¬P(x)）、多重量化。

Practice quizzes (3-5問): 法律文書の「すべての〜は」「〜が存在する」の論理分析、SQLクエリのWHERE句と量化子の対応、要件定義の曖昧さ検出。

Theory quizzes (5問): 量化子の否定の選択式、日本語文の形式化。

Philosophy: フレーゲの『概念記法』（1879）、ラッセルのパラドックスと型理論、ゲーデルの不完全性定理への道。

**Commit:** `feat: add Chapter 4 — Predicate Logic Basics`

---

### Task 6: Add Chapter 5 content — 非形式的誤謬

**Files:** Same pattern for `05-fallacies/`

Theory: 誤謬の分類（関連性の誤謬、不当な前提の誤謬、曖昧さの誤謬）。主要な誤謬：人身攻撃、訴えかけの誤謬（感情・権威・多数）、藁人形論法、滑りやすい坂論法、偽の二択、循環論法。

Practice quizzes (3-5問): SNSの議論での誤謬検出、営業トークの誤謬分析、政治的議論の誤謬特定。

Theory quizzes (5問): 誤謬の種類を選択する問題。

Philosophy: ソフィストと修辞学の伝統、アリストテレスの『詭弁論駁論』、現代のクリティカルシンキング教育。

**Commit:** `feat: add Chapter 5 — Informal Fallacies`

---

### Task 7: Add Chapter 6 content — 実践総合演習

**Files:** Same pattern for `06-synthesis/`

Theory: 総合復習。形式論理（命題→述語）と非形式論理（誤謬検出）の統合。議論の分析フレームワーク：前提の特定→論証形式の確認→妥当性判定→誤謬チェック。

Practice quizzes (5-8問): 実際のビジネスメール・会議の論理分析、法的文書の論理チェック、技術仕様書の一貫性検証、営業プレゼンの論理構造設計。

Philosophy: 論理学の限界と直感の役割、ウィトゲンシュタインの「語りえぬもの」、プラグマティズムと論理学。

**Commit:** `feat: add Chapter 6 — Synthesis and Practical Exercises`

---

### Task 8: SM-2 Spaced Repetition System

**Files:**
- Create: `src/lib/spaced-repetition.ts`
- Create: `src/lib/__tests__/spaced-repetition.test.ts`
- Modify: `src/types/progress.ts` (add ReviewItem to UserProgress)
- Modify: `src/lib/progress.ts` (add review queue management)
- Modify: `src/hooks/use-progress.ts` (add review functions)

**SM-2 Algorithm implementation:**

```typescript
interface ReviewItem {
  quizId: string
  chapterSlug: string
  section: "theory" | "practice"
  nextReview: string      // ISO date
  interval: number        // days
  easeFactor: number      // starts at 2.5, min 1.3
  repetitions: number
}

type ResponseQuality = 0 | 1 | 2 | 3 | 4 | 5
// 0-2: incorrect (reset), 3: correct with difficulty, 4: correct, 5: easy

function calculateNextReview(item: ReviewItem, quality: ResponseQuality): ReviewItem
```

TDD: Write tests for SM-2 interval calculation, ease factor updates, queue management.

**Commit:** `feat: add SM-2 spaced repetition algorithm`

---

### Task 9: Review Page (/review)

**Files:**
- Create: `src/app/review/page.tsx`
- Modify: `src/app/page.tsx` (add review link to dashboard)

The review page:
1. Gets items due for review from the progress store (where `nextReview <= today`)
2. Presents them one by one using the appropriate quiz component
3. After answering, shows quality rating buttons (Again / Hard / Good / Easy)
4. Updates the review queue based on SM-2 calculation
5. Shows "No reviews due" when queue is empty

Also update the dashboard to show a review card with count of due items.

**Commit:** `feat: add spaced repetition review page`

---

### Task 10: Vercel Deploy Preparation

**Files:**
- Modify: `next.config.ts` (ensure output is compatible)
- Modify: `package.json` (ensure build script is correct)

**Steps:**
1. Run `pnpm build` — verify clean build
2. Run all tests — verify all pass
3. Ensure no environment variables are required (pure static + localStorage)
4. The app should be deployable with `vercel` CLI or GitHub integration

**No actual deploy** — just ensure readiness. The user will deploy themselves.

**Commit:** `chore: prepare for Vercel deployment`

---

## Summary

| Task | Description |
|------|-------------|
| 1 | @tailwindcss/typography |
| 2 | Refactor content loading for multi-chapter |
| 3 | Chapter 2: 真理値表と恒真式 |
| 4 | Chapter 3: 論証の妥当性と健全性 |
| 5 | Chapter 4: 述語論理の基礎 |
| 6 | Chapter 5: 非形式的誤謬 |
| 7 | Chapter 6: 実践総合演習 |
| 8 | SM-2 Spaced Repetition System |
| 9 | Review Page |
| 10 | Vercel Deploy Preparation |
