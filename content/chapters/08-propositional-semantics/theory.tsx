import {
  Callout,
  FormulaBlock,
  ComparisonTable,
  KeyPoint,
  SectionDivider,
  MotivationSection,
} from "@/components/content"
import {
  TruthValueAnimator,
  ExampleMapping,
  InlineMiniQuiz,
  StudyNotes,
} from "@/components/interactive"

export function TheoryContent() {
  return (
    <>
    <article className="prose prose-zinc max-w-none">
      <h1>第5章: 命題論理の意味論と完全性</h1>

      <MotivationSection
        icon="🔍"
        realWorldExample="「証明できること」と「正しいこと」は同じか？ 論理体系の信頼性を根本から問う。"
        nextChapterConnection="述語論理の自然演繹で表現力を拡張"
      />

      <h2>構文と意味論の区別</h2>

      <p>
        前章では自然演繹による形式的証明を学びました。
        推論規則を適用して結論に到達する——これは論理式の
        <strong>構文（syntax）</strong>に関する操作です。
        記号の並びとして正しい変換手続きかどうかだけを問います。
      </p>

      <p>
        一方、第2章で学んだ真理値表は、論理式の
        <strong>意味論（semantics）</strong>に関する操作です。
        命題変数に真偽を割り当て、論理式の「意味」（真偽値）を計算します。
      </p>

      <Callout variant="definition" label="定義">
        <strong>構文（syntax）</strong>とは、論理式の形式的な構造と、
        推論規則による記号操作のレベルです。
        <strong>意味論（semantics）</strong>とは、論理式に真偽値を割り当て、
        その「意味」を解釈するレベルです。
      </Callout>

      <ComparisonTable
        headers={["構文（Syntax）", "意味論（Semantics）"]}
        rows={[
          ["記号の並びと規則", "記号の意味と解釈"],
          ["推論規則を適用", "真偽値を計算"],
          ["「証明できるか」を問う", "「真であるか」を問う"],
          ["⊢（ターンスタイル）", "⊨（二重ターンスタイル）"],
          ["自然演繹、公理系", "真理値表、モデル理論"],
        ]}
      />

      <p>
        この二つのレベルは、一見異なるもののように見えます。
        しかし、実は深い関係で結ばれています。
        それを明らかにするのが、この章の主題である
        健全性定理と完全性定理です。
      </p>

      <KeyPoint>
        構文は「証明の操作」、意味論は「真理の解釈」を扱う。
        二つのレベルの関係を理解することが、論理体系の信頼性を保証する鍵となる。
      </KeyPoint>

      <SectionDivider />

      <h2>意味的帰結と統語的帰結</h2>

      <Callout variant="definition" label="定義">
        <strong>意味的帰結（semantic consequence, ⊨）</strong>:
        前提の集合 Γ のすべての式が真であるようなすべての付値（解釈）において、
        結論 φ も真であるとき、Γ ⊨ φ と書きます。
      </Callout>

      <FormulaBlock caption="意味的帰結の定義">
        Γ ⊨ φ ⟺ Γ のすべての式を真にするすべての付値で φ も真
      </FormulaBlock>

      <p>
        直感的には、「前提が真なら結論も必ず真になる」ということです。
        第3章で学んだ「妥当性」を形式的に定義したものです。
        真理値表で全ての行を調べ、前提が全て真の行で結論も真であることを確認します。
      </p>

      <Callout variant="definition" label="定義">
        <strong>統語的帰結（syntactic consequence, ⊢）</strong>:
        前提の集合 Γ から推論規則を有限回適用して結論 φ を導出できるとき、
        Γ ⊢ φ と書きます。
      </Callout>

      <FormulaBlock caption="統語的帰結の定義">
        Γ ⊢ φ ⟺ Γ から推論規則の適用で φ を導出できる
      </FormulaBlock>

      <p>
        こちらは、前章で学んだ自然演繹の証明がまさに ⊢ の関係です。
        前提から推論規則を適用して結論に到達できるかどうかを問います。
      </p>

      <ExampleMapping
        formula="P → Q, P ⊨ Q"
        example="「PならばQ」と「P」が両方真なら、「Q」も必ず真"
        variables={{ "P → Q": "条件文（前提1）", "P": "前件（前提2）", "Q": "結論" }}
        caption="意味的帰結: 真理値表で確認できる"
      />

      <ExampleMapping
        formula="P → Q, P ⊢ Q"
        example="「PならばQ」と「P」から →E で「Q」を導出"
        variables={{ "P → Q": "条件文（前提1）", "P": "前件（前提2）", "Q": "→E の結論" }}
        caption="統語的帰結: 推論規則で証明できる"
      />

      <Callout variant="warning" label="記号の区別">
        ⊨（二重ターンスタイル）と ⊢（ターンスタイル）は異なる概念です。
        ⊨ は「意味的に正しい（真理値表で確認）」を表し、
        ⊢ は「形式的に証明できる（推論規則で導出）」を表します。
        この区別は極めて重要です。
      </Callout>

      <InlineMiniQuiz
        question="⊨ と ⊢ の違いとして正しいのはどれですか？"
        options={[
          "⊨ は意味的帰結（真理値で判定）、⊢ は統語的帰結（規則で導出）",
          "⊨ は統語的帰結、⊢ は意味的帰結",
          "⊨ と ⊢ は同じ意味の別記法",
          "⊨ は命題論理用、⊢ は述語論理用"
        ]}
        correctIndex={0}
        explanation="⊨ は真理値のレベルで「正しい」こと、⊢ は推論規則のレベルで「証明できる」ことを表します。二つは異なる概念ですが、健全性と完全性により一致します。"
      />

      <SectionDivider />

      <h2>充足可能性と恒真式</h2>

      <Callout variant="definition" label="定義">
        論理式 φ が<strong>充足可能（satisfiable）</strong>であるとは、
        φ を真にする付値（真偽値の割り当て）が少なくとも一つ存在することです。
      </Callout>

      <Callout variant="definition" label="定義">
        論理式 φ が<strong>恒真式（tautology）</strong>であるとは、
        すべての付値において φ が真であることです。
        ⊨ φ と書きます（前提なしの意味的帰結）。
      </Callout>

      <Callout variant="definition" label="定義">
        論理式 φ が<strong>矛盾式（contradiction）</strong>であるとは、
        すべての付値において φ が偽であることです。
        矛盾式は充足不可能です。
      </Callout>

      <ComparisonTable
        headers={["分類", "条件と例"]}
        rows={[
          ["恒真式（tautology）", "すべての付値で真。例: P ∨ ¬P"],
          ["矛盾式（contradiction）", "すべての付値で偽。例: P ∧ ¬P"],
          ["充足可能式（contingency）", "真になる付値が存在。例: P ∧ Q"],
        ]}
      />

      <p>
        恒真式は充足可能式の特殊なケース（すべての付値で真）です。
        矛盾式は充足不可能式と同じです。
        多くの日常的な命題は恒真式でも矛盾式でもない「偶然的な」充足可能式です。
      </p>

      <TruthValueAnimator
        variables={["P", "Q"]}
        formula="(P → Q) ∨ (Q → P)"
        evaluate={(v) => (!v.P || v.Q) || (!v.Q || v.P)}
        caption="(P → Q) ∨ (Q → P) はすべての付値で真（恒真式）であることを確認しましょう"
      />

      <FormulaBlock caption="充足可能性と恒真式の関係">
        φ が恒真 ⟺ ¬φ が充足不可能{"\n"}
        φ が充足可能 ⟺ ¬φ が恒真でない
      </FormulaBlock>

      <KeyPoint>
        充足可能性は「真にできるか」、恒真式は「常に真か」を問う。
        φ が恒真であることと ¬φ が充足不可能であることは同値——
        これは反例による否定の形式的な基盤である。
      </KeyPoint>

      <SectionDivider />

      <h2>健全性定理</h2>

      <Callout variant="definition" label="定義">
        <strong>健全性定理（Soundness Theorem）</strong>:
        Γ ⊢ φ ならば Γ ⊨ φ。
        すなわち、推論規則で証明できることは、意味的にも正しい。
      </Callout>

      <FormulaBlock caption="健全性定理">
        Γ ⊢ φ ⟹ Γ ⊨ φ{"\n"}
        （証明可能ならば、意味的に正しい）
      </FormulaBlock>

      <p>
        健全性は、証明体系の<strong>信頼性</strong>を保証します。
        推論規則に従って得た結論は、決して「嘘」ではありません。
        もし健全性が成り立たなければ、
        前提がすべて真なのに偽の結論を「証明」できてしまい、
        証明体系は信頼できないものになります。
      </p>

      <p>
        健全性の証明は、各推論規則が「真理を保存する」ことを
        個別に確認することで行います。
        例えば →E（モーダスポネンス）について:
        P → Q が真で P が真ならば、含意の定義により Q も真です。
        したがって →E は真理を保存します。
        すべての規則がこの性質を持つことを示せば、
        規則の有限回の適用で得られた結論も真理を保存します。
      </p>

      <Callout variant="tip" label="健全性の直感">
        健全性は「嘘をつかない保証」です。
        証明体系が健全であれば、証明した結果を安心して信じることができます。
        テストに例えるなら「テストが通ったコードは実際に正しい」に対応します
        （ただし、テストカバレッジが100%の理想的な場合に限ります）。
      </Callout>

      <KeyPoint>
        健全性定理は「証明できるなら正しい」ことを保証する。
        各推論規則が真理を保存することの帰結として成り立つ。
      </KeyPoint>

      <SectionDivider />

      <h2>完全性定理</h2>

      <Callout variant="definition" label="定義">
        <strong>完全性定理（Completeness Theorem）</strong>:
        Γ ⊨ φ ならば Γ ⊢ φ。
        すなわち、意味的に正しいことは、すべて証明できる。
      </Callout>

      <FormulaBlock caption="完全性定理">
        Γ ⊨ φ ⟹ Γ ⊢ φ{"\n"}
        （意味的に正しいならば、証明可能）
      </FormulaBlock>

      <p>
        完全性は、健全性の逆方向です。
        真理値表で確認できるすべての妥当な推論は、
        自然演繹の規則だけで必ず証明できることを主張します。
        証明体系に「抜け」がないことの保証です。
      </p>

      <p>
        完全性定理の証明は健全性よりもはるかに難しく、
        クルト・ゲーデルが1930年の博士論文で初めて証明しました
        （述語論理を含む一階論理に対して）。
        命題論理に限れば、完全性はより直接的に示すことができます。
      </p>

      <Callout variant="tip" label="完全性の直感">
        完全性の直感的な意味は次の通りです:
        真理値表を使って「この推論は正しい」とわかったなら、
        必ず自然演繹でもその証明を構成できます。
        「正しいのに証明できない」という命題は、
        命題論理には存在しません。
      </Callout>

      <ComparisonTable
        headers={["健全性", "完全性"]}
        rows={[
          ["⊢ ⟹ ⊨", "⊨ ⟹ ⊢"],
          ["証明可能 → 意味的に正しい", "意味的に正しい → 証明可能"],
          ["証明体系の信頼性", "証明体系の十分性"],
          ["各規則が真理を保存", "証明に「抜け」がない"],
          ["比較的容易に証明", "ゲーデルが初めて証明"],
        ]}
      />

      <p>
        健全性と完全性を合わせると、⊢ と ⊨ が完全に一致することがわかります。
      </p>

      <FormulaBlock caption="健全性 + 完全性">
        Γ ⊢ φ ⟺ Γ ⊨ φ{"\n"}
        （証明可能であることと意味的に正しいことは同値）
      </FormulaBlock>

      <p>
        これは驚くべき結果です。
        「記号を操作する」という純粋に構文的な手続きと、
        「真偽値を計算する」という意味的な手続きが、
        命題論理においては完全に同じ結果を与えるのです。
      </p>

      <InlineMiniQuiz
        question="健全性と完全性の両方が成り立つとき、何が言えますか？"
        options={[
          "証明可能であることと意味的に正しいことが完全に一致する",
          "すべての論理式が証明可能になる",
          "すべての論理式が恒真式になる",
          "推論規則が不要になる"
        ]}
        correctIndex={0}
        explanation="健全性（⊢ ⟹ ⊨）と完全性（⊨ ⟹ ⊢）を合わせると ⊢ ⟺ ⊨ となり、構文的な証明可能性と意味的な正しさが完全に一致します。"
      />

      <SectionDivider />

      <h2>決定可能性</h2>

      <Callout variant="definition" label="定義">
        論理体系が<strong>決定可能（decidable）</strong>であるとは、
        任意の論理式に対して、それが恒真式かどうか（あるいは妥当かどうか）を
        有限の手続きで判定するアルゴリズムが存在することです。
      </Callout>

      <p>
        命題論理は<strong>決定可能</strong>です。
        真理値表を構成すれば、任意の論理式が恒真式かどうかを機械的に判定できます。
        変数が n 個あれば 2<sup>n</sup> 行の真理値表を作成して全行を確認すればよいのです。
      </p>

      <p>
        ただし、変数の数が増えると真理値表のサイズは指数的に増大します。
        20変数で約100万行、30変数で約10億行になります。
        「判定可能」であることと「効率的に判定可能」であることは別問題です。
        実際、命題論理の充足可能性判定問題（SAT問題）は
        NP完全問題であることが知られており、
        効率的なアルゴリズムの存在は未解決問題です（P ≠ NP 予想）。
      </p>

      <TruthValueAnimator
        variables={["P", "Q"]}
        formula="P → (Q → P)"
        evaluate={(v) => !v.P || (!v.Q || v.P)}
        caption="P → (Q → P) は恒真式。真理値表で機械的に確認できるのが決定可能性の例。"
      />

      <Callout variant="warning" label="述語論理との対比">
        命題論理は決定可能ですが、述語論理（一階論理）は
        <strong>決定不可能</strong>です（チャーチ-チューリングの定理、1936年）。
        述語論理では、任意の論理式が恒真式かどうかを
        機械的に判定するアルゴリズムが存在しません。
        ただし、述語論理でも完全性は成り立ちます——
        「正しいならば証明できる」が、
        「正しいかどうかを自動的に判定できる」とは異なるのです。
      </Callout>

      <ComparisonTable
        headers={["命題論理", "述語論理"]}
        rows={[
          ["健全性: 成り立つ", "健全性: 成り立つ"],
          ["完全性: 成り立つ", "完全性: 成り立つ"],
          ["決定可能", "決定不可能"],
          ["真理値表で判定可能", "一般的な判定アルゴリズムなし"],
        ]}
      />

      <KeyPoint>
        命題論理は決定可能——真理値表で任意の論理式の恒真性を機械的に判定できる。
        ただし、述語論理は決定不可能であり、
        「証明できるか」と「自動判定できるか」は異なる概念である。
      </KeyPoint>

      <SectionDivider />

      <h2>まとめ: 構文と意味論の調和</h2>

      <p>
        この章で学んだ中心的な結果をまとめます。
      </p>

      <FormulaBlock caption="命題論理の基本定理">
        健全性: ⊢ φ ⟹ ⊨ φ{"\n"}
        完全性: ⊨ φ ⟹ ⊢ φ{"\n"}
        決定可能性: ⊨ φ かどうかをアルゴリズムで判定可能
      </FormulaBlock>

      <p>
        命題論理は、構文（証明）と意味論（真理）が完全に一致する、
        非常に「行儀の良い」論理体系です。
        証明できることと正しいことが同じであり、
        さらにそれを機械的に判定することもできます。
      </p>

      <p>
        しかし、この美しい調和は、より表現力の強い論理体系に移ると
        部分的に崩れていきます。
        述語論理では完全性は保たれますが決定可能性が失われ、
        算術を含む体系ではゲーデルの不完全性定理により
        完全性そのものが失われます。
        命題論理の調和は、出発点としての理想形なのです。
      </p>

      <InlineMiniQuiz
        question="命題論理について正しい記述はどれですか？"
        options={[
          "健全かつ完全であり、決定可能である",
          "健全だが完全ではない",
          "完全だが健全ではない",
          "決定不可能である"
        ]}
        correctIndex={0}
        explanation="命題論理は健全性・完全性・決定可能性のすべてを満たす理想的な論理体系です。この三つの性質がすべて揃うのは命題論理の特徴です。"
      />

      <ExampleMapping
        formula="⊢ φ ⟺ ⊨ φ"
        example="自然演繹で証明できることと、真理値表で確認できることは同じ"
        variables={{ "⊢ φ": "推論規則で証明可能", "⊨ φ": "すべての付値で真" }}
        caption="命題論理における構文と意味論の完全な一致"
      />
    </article>
    <div className="not-prose my-8">
      <StudyNotes chapterSlug="08-propositional-semantics" />
    </div>
    </>
  )
}
